# Rendering Effects (Pre-BMM Archive)

> **Spec Version**: 1.0.0
> **Last Updated**: 2026-02-15
> **Archive Snapshot**: 2025-11-25 05:55:21
> **Depends On**: [player.md](player.md), [combat.md](combat.md), [main-scene.md](main-scene.md), [texture-generator.md](texture-generator.md)
> **Depended By**: [ui.md](ui.md), [input.md](input.md)

---

## Overview

The rendering effects system encompasses all transient visual feedback in the prototype: the minimap, bullet tracers, hit markers, directional damage indicators, damage numbers, blood particles, health regeneration particles, melee slash arcs, muzzle flashes, weapon drop effects, and death corpse graphics. These are **not** managed by dedicated manager classes — they are ad-hoc effects created and destroyed inline within `MainScene.ts` and `StickFigure.ts`.

All effects use Phaser's built-in primitives (`Graphics`, `Circle`, `Text`, `Sprite`, `Tweens`) with no external assets. Procedural textures generated by `TextureGenerator.ts` provide the `hitmarker`, `hit_indicator`, `bullet_pellet`, and `bullet_tracer` sprites used by several effects.

**Source files:**
- `game/scenes/MainScene.ts` — Minimap, tracers, hit markers, damage numbers, blood particles, health regen FX, melee arcs, weapon drops, death corpse overlapping (lines ~139–974)
- `game/objects/StickFigure.ts` — Muzzle flash, recoil animation, reload bar, death corpse drawing (lines ~196–456)
- `game/utils/TextureGenerator.ts` — Procedural texture generation for `hitmarker`, `hit_indicator`, `bullet_pellet`, `bullet_tracer`, `reticle`, weapon drop icons

---

## Dependencies

### Technology Dependencies

| Technology | Version | Purpose |
|------------|---------|---------|
| Phaser | 3 | Graphics API, Tweens, Physics for particles |
| TypeScript | — | Source language |

### Spec Dependencies

- [player.md](player.md) — StickFigure entity, `takeDamage()`, `die()`, `playAttackAnimation()`
- [combat.md](combat.md) — Damage flow, melee attacks, ranged attacks
- [main-scene.md](main-scene.md) — Game loop, `update()` call order
- [texture-generator.md](texture-generator.md) — Procedural textures: `hitmarker`, `hit_indicator`, `bullet_pellet`, `bullet_tracer`, `reticle`, `drop_*`

---

## Constants

| Constant | Value | Unit | Description | Source |
|----------|-------|------|-------------|--------|
| Minimap scale | 0.075 | ratio | World-to-minimap pixel ratio (1600 × 0.075 = 120px) | MainScene ~L245, ~L277 |
| Minimap position | (20, 20) | px | Top-left corner of minimap on screen | MainScene ~L247–248 |
| Radar range | 600 | px | Enemies beyond this distance hidden from minimap | MainScene ~L280 |
| Tracer fade rate | delta / 150 | alpha/frame | Alpha subtracted per frame (150ms to fully fade) | MainScene ~L228 |
| Tracer line width | 1 | px | Stroke width for tracer lines | MainScene ~L232 |
| Blood particle count | 5 | count | Particles spawned per player-damage event | MainScene ~L959 |
| Blood particle size | 2–5 | px radius | Random radius per blood particle | MainScene ~L960 |
| Blood particle speed | 50–150 | px/s | Random outward burst velocity | MainScene ~L962 |
| Blood particle drag | 200 | px/s² | Deceleration applied to blood particles | MainScene ~L967 |
| Blood particle duration | 500 | ms | Fade-out + scale-to-zero tween | MainScene ~L969–972 |
| Damage number duration | 800 | ms | Float-up + fade-out time | MainScene ~L856 |
| Damage number rise | 50 | px | Vertical distance text floats upward (y-30 to y-80) | MainScene ~L850, ~L856 |
| Hit marker fade duration | 150 | ms | Alpha + scale tween for hitmarker sprite | MainScene ~L820 |
| Hit indicator fade duration | 200 | ms | Fade for directional chevron indicator (on dealing damage) | MainScene ~L836 |
| Hit indicator (received) fade | 400 | ms | Fade for directional chevron when player takes damage | MainScene ~L952 |
| Camera shake on hit dealt | 50ms, 0.001 intensity | — | Camera shake when player lands a hit | MainScene ~L846 |
| Camera flash on hit received | 100ms, RGB(128,0,0) | — | Red flash overlay when player takes damage | MainScene ~L957 |
| Melee slash arc fade | 200 | ms | Alpha tween for melee arc graphic | MainScene ~L524 |
| Muzzle flash size | 8 | px radius | Base circle radius (randomized ×0.8–1.2) | StickFigure ~L226 |
| Muzzle flash shotgun scale | 1.5 | multiplier | Larger flash for shotgun | StickFigure ~L239 |
| Muzzle flash duration | 40 | ms | Alpha + scale tween | StickFigure ~L241–247 |
| Health regen particle chance | 15% | per frame | `Math.random() > 0.85` check during regen | MainScene ~L389 |
| Health regen particle size | 2 | px radius | Green circle | MainScene ~L390–391 |
| Health regen particle rise | 20 | px | Floats upward | MainScene ~L396 |
| Health regen particle duration | 600 | ms | Fade-out tween | MainScene ~L396 |
| Weapon drop bob distance | 5 | px | Vertical yoyo animation amplitude | MainScene ~L895 |
| Weapon drop bob duration | 1000 | ms | One full bob cycle | MainScene ~L895 |
| Weapon drop glow radius | 20 | px | Pulsing ring around drop | MainScene ~L899 |
| Weapon drop lifetime | 30000 | ms | Auto-destroy after 30 seconds | MainScene ~L906 |
| Death corpse fade delay | 5000 | ms | Corpse visible for 5s before fading | StickFigure ~L453 |
| Death corpse fade duration | 2000 | ms | Alpha tween to 0 | StickFigure ~L449 |

---

## Data Structures

### Tracer

Defined at the top of `MainScene.ts` (~line 18):

```typescript
interface Tracer {
    x1: number;  // Start x (player position)
    y1: number;  // Start y (player position)
    x2: number;  // End x (target position)
    y2: number;  // End y (target position)
    alpha: number;  // Current alpha (starts at 1, fades to 0)
    color: number;  // Hex color (0xffffff for hit, 0xff0000 for kill)
}
```

Stored in `MainScene.activeTracers: Tracer[]`. Rendered by a shared `Phaser.GameObjects.Graphics` instance (`tracerGraphics`) at depth 999.

---

## Behavior

### 1. Minimap

The minimap is rendered in the top-left corner of the screen using two `Phaser.GameObjects.Graphics` layers:

- **Static layer** (`minimapStaticGraphics`, depth 1999): Background rectangle and wall positions. Drawn once in `drawMinimapStatic()` during `create()`.
- **Dynamic layer** (`minimapGraphics`, depth 2000): Player dot, enemy dots, radar range ring, and aim direction line. Redrawn every frame in `updateMinimap()`.

Both layers use `setScrollFactor(0)` so they stay fixed on screen regardless of camera position.

**Static layer rendering** (`drawMinimapStatic`, ~L241–271):
```
1. Fill black background rect (0x000000, alpha 0.7) at (20, 20), size 120×120
2. Stroke white border (2px, 0xffffff, alpha 0.5)
3. For each wall in this.walls:
   a. Fill gray rect (0x555555) at scaled position
   b. Cache wall bounds in this.wallBounds[] for LOS checks
```

**Dynamic layer rendering** (`updateMinimap`, ~L273–326):
```
1. Clear graphics
2. For each active, living enemy:
   a. Calculate distance from player to enemy
   b. If distance > radarRange (600px), skip (enemy not shown)
   c. Draw red dot (0xff0000, radius 3) at scaled position
3. If player alive:
   a. Draw green dot (0x00ff00, radius 4) at scaled position
   b. Draw radar range ring (1px, 0x00ff00, alpha 0.15) with radius = 600 × 0.075 = 45px
   c. Draw aim direction line (1px, 0x00ff00, alpha 0.8) from player dot, length 10px
```

**Coordinate mapping**: `minimapX = mapX + worldX * scale`, `minimapY = mapY + worldY * scale`, where `scale = 0.075`, `mapX = mapY = 20`.

### 2. Bullet Tracers

Tracers are ephemeral lines connecting the player to the point of hit. They are created in `showHitMarker()` and rendered/updated in `updateTracers()`.

**Creation** (`showHitMarker`, ~L841–844):
```typescript
this.activeTracers.push({
    x1: this.player.x, y1: this.player.y,
    x2: target.x, y2: target.y,
    alpha: 1,
    color: kill ? 0xff0000 : 0xffffff  // Red for kills, white for hits
});
```

**Update** (`updateTracers`, ~L223–239, called every frame):
```
1. Clear tracerGraphics
2. For each tracer (iterate backwards):
   a. Subtract delta/150 from alpha
   b. If alpha <= 0: remove from array
   c. Else: draw line from (x1,y1) to (x2,y2) with lineStyle(1, color, alpha)
```

Tracers are drawn in **world space** (not screen space), so they scroll with the camera. The `tracerGraphics` object is at depth 999.

Tracers are cleared on scene shutdown via `this.activeTracers = []` in the `shutdown` event handler.

### 3. Hit Markers

When the player damages an enemy, a visual "X" hit marker appears at the **reticle position** (not the enemy position). This provides feedback aligned with where the player is aiming.

**Implementation** (`showHitMarker`, ~L809–847):

```typescript
// 1. Hitmarker sprite at reticle
const marker = this.add.sprite(this.reticle.x, this.reticle.y, 'hitmarker').setDepth(1000);
if (kill) {
    marker.setTint(0xff0000).setScale(2.0);    // Red, large for kills
} else {
    marker.setTint(0xffffff).setScale(1.2);    // White, smaller for hits
}
// Tween: fade alpha to 0, shrink to 50% scale, 150ms
```

The `hitmarker` texture is a white "X" shape (20×20px) generated by `TextureGenerator`.

**Kill vs hit distinction:**
- Kill: Red tint (`0xff0000`), scale 2.0
- Hit: White tint (`0xffffff`), scale 1.2

### 4. Directional Hit Indicators (Dealing Damage)

In addition to the hit marker, a directional chevron indicator appears around the player pointing toward the damaged enemy.

**Implementation** (`showHitMarker`, ~L825–839):

```typescript
const angle = Phaser.Math.Angle.Between(player.x, player.y, target.x, target.y);
const radius = 60;  // Distance from player center
const ix = player.x + Math.cos(angle) * radius;
const iy = player.y + Math.sin(angle) * radius;

const indicator = this.add.sprite(ix, iy, 'hit_indicator').setDepth(1001);
indicator.setRotation(angle);
indicator.setTint(kill ? 0xff0000 : 0xffffff);
// Tween: fade alpha to 0, scale to 1.5, 200ms
```

The `hit_indicator` texture is a chevron/arrow shape (16×16px) from `TextureGenerator`.

### 5. Directional Hit Indicators (Receiving Damage)

When the player takes damage, a separate indicator shows the direction damage came from, plus camera effects and blood particles.

**Implementation** (`showDamageReceived`, ~L940–973):

```
1. Directional chevron:
   - Same calculation as dealing-damage indicator but always red (0xff0000)
   - Longer fade: 400ms (vs 200ms for dealing damage)
   - Positioned 60px from player center toward damage source

2. Camera flash:
   - cameras.main.flash(100, 128, 0, 0) — red flash, 100ms

3. Blood particles (5 particles):
   For each particle:
   a. Create circle at player position, random radius 2–5px, color 0xcc0000
   b. Calculate angle from damage source toward player + random ±0.5 radians
   c. Set velocity from angle at random speed 50–150 px/s
   d. Add physics body with drag = 200
   e. Tween: alpha to 0, scale to 0, 500ms, then destroy
```

### 6. Damage Numbers

Floating damage numbers appear above damaged entities to show the numeric damage value.

**Implementation** (`showDamageNumber`, ~L849–860):

```typescript
const text = this.add.text(x, y - 30, amount.toString(), {
    fontSize: isCrit ? '24px' : '16px',
    color: isCrit ? '#ff0000' : '#ffffff',
    stroke: '#000000', strokeThickness: 2,
    fontFamily: 'Arial'
}).setOrigin(0.5).setDepth(1000);

// Tween: y moves to y-80 (rises 50px), alpha to 0, 800ms
```

**Usage contexts:**
- **Player hits enemy** (`damageEnemy`, ~L871–872): `showDamageNumber(enemy.x, enemy.y, amount, isKill)` — full scale
- **Enemy hits enemy** (`damageEnemy`, ~L874): Same call but `.setScale(0.7).setAlpha(0.8)` — smaller/dimmer for non-player attacks
- **Weapon pickup** (`handleWeaponPickup`, ~L917): Reuses `showDamageNumber` with amount=0 and overrides text to `"Picked up {weaponName}"`

**"isCrit" parameter**: Despite the name, this is actually the `isKill` flag — kills show as 24px red text, non-kills as 16px white text.

### 7. Melee Slash Arc

When a melee attack is executed, a white arc is drawn at the attacker's position showing the swing range and angle.

**Implementation** (`performMeleeAttack`, ~L519–524):

```typescript
const slash = this.add.graphics();
slash.lineStyle(2, 0xffffff, 0.8);
slash.beginPath();
slash.arc(attacker.x, attacker.y, range, angle - 0.7, angle + 0.7, false);
slash.strokePath();
// Tween: alpha to 0, 200ms, then destroy
```

The arc spans ±0.7 radians (~40°) from the attacker's rotation, at the weapon's range radius (90px for BAT, 110px for KATANA).

### 8. Muzzle Flash

Ranged weapons produce a muzzle flash at the barrel position when firing.

**Implementation** (`StickFigure.playAttackAnimation`, ~L225–248):

```typescript
// Create yellow-white circle at barrel tip
const flash = this.scene.add.circle(0, 0, 8, 0xffffaa);
this.weaponContainer.add(flash);

// Position at barrel end
let barrelLen = 30;  // Default
if (this.weaponType === WeaponType.AK47) barrelLen = 50;
if (this.weaponType === WeaponType.UZI) barrelLen = 35;
if (this.weaponType === WeaponType.SHOTGUN) barrelLen = 45;
flash.setPosition(barrelLen, -1);

// Randomize size
flash.setScale(0.8 + Math.random() * 0.4);
if (this.weaponType === WeaponType.SHOTGUN) flash.setScale(1.5);  // Bigger flash

// Tween: alpha to 0, scale to 0.5, 40ms, then destroy
```

The flash is added to the `weaponContainer`, so it rotates with the weapon. It fades in 40ms.

### 9. Gun Recoil Animation

Ranged weapons visually kick back when fired.

**Implementation** (`StickFigure.playAttackAnimation`, ~L213–223):

```typescript
this.recoilOffset = 0;
let recoilDist = -6;  // Default kickback distance
if (this.weaponType === WeaponType.SHOTGUN) recoilDist = -10;  // Harder kick

this.scene.tweens.add({
    targets: this,
    recoilOffset: recoilDist,
    duration: 50,
    yoyo: true  // Snaps back to 0
});
```

The `recoilOffset` shifts the weapon container and arm positions backward along the rotation axis. It is applied in `updateAttachments()` via `Math.cos(rotation) * recoilOffset` and `Math.sin(rotation) * recoilOffset`.

### 10. Melee Swing Animation

Melee weapons visually swing through an arc.

**Implementation** (`StickFigure.playAttackAnimation`, ~L199–211):

```typescript
this.isAttacking = true;
this.scene.tweens.add({
    targets: this.weaponContainer,
    angle: { from: this.weaponContainer.angle - 45, to: this.weaponContainer.angle + 60 },
    duration: 100,
    yoyo: true,
    onComplete: () => {
        this.isAttacking = false;
        this.weaponContainer.setAngle(0);
    }
});
```

The swing covers 105° total (-45° to +60°) in 100ms, then reverses back. During `isAttacking`, `updateAttachments` skips setting rotation on the weapon container so the tween controls it.

### 11. Reload Bar

A progress bar appears above reloading units showing reload completion.

**Implementation** (`StickFigure.drawReloadBar`, ~L102–117):

```typescript
// Bar dimensions: 40×6 px, centered above head at y-60
const w = 40, h = 6;
const x = this.x - w / 2;
const y = this.y - 60;

// Background: black, 80% alpha
this.reloadBar.fillStyle(0x000000, 0.8);
this.reloadBar.fillRect(x, y, w, h);

// Progress fill: white
this.reloadBar.fillStyle(0xffffff, 1);
this.reloadBar.fillRect(x + 1, y + 1, (w - 2) * progress, h - 2);
```

The bar is driven by a `tweens.addCounter` in `MainScene.reloadWeapon()` that goes from 0 to 1 over the weapon's `reloadTime`. It is cleared when progress reaches 0 or 1.

### 12. Reload Visual Animation

The weapon container pulses during reload to provide visual feedback.

**Implementation** (`StickFigure.playReloadAnimation`, ~L175–193):

```typescript
this.scene.tweens.add({
    targets: this.weaponContainer,
    alpha: 0.5,
    scaleX: 0.8,
    scaleY: 0.8,
    duration: 200,
    yoyo: true,
    repeat: 2,
    onComplete: () => {
        this.weaponContainer.setAlpha(1);
        this.weaponContainer.setScale(1);
    }
});
```

The weapon fades to 50% alpha and shrinks to 80% scale, then bounces back. This repeats 3 times (initial + 2 repeats) across the reload duration.

### 13. Health Regeneration Particles

When the player is regenerating health (after `REGEN_DELAY = 3000ms` without taking damage), small green particles occasionally float upward.

**Implementation** (`handleHealthRegen`, ~L388–400):

```typescript
if (Math.random() > 0.85) {  // ~15% chance per frame
    const part = this.add.circle(
        this.player.x + (Math.random() - 0.5) * 25,  // Random offset ±12.5px
        this.player.y + (Math.random() - 0.5) * 25,
        2,       // Radius
        0x00ff00 // Green
    );
    this.tweens.add({
        targets: part, y: part.y - 20, alpha: 0, duration: 600,
        onComplete: () => part.destroy()
    });
}
```

Particles spawn at random positions within a 25×25px area around the player, float 20px upward over 600ms, and fade to transparent.

### 14. Weapon Drop Effects

When an enemy dies, they drop their weapon as a pickup item with visual effects.

**Implementation** (`spawnWeaponDrop`, ~L888–912):

```typescript
// 1. Create drop sprite using pre-generated texture
const drop = this.weaponDrops.create(x, y, `drop_${type}`);
drop.setDepth(5);

// 2. Bobbing animation: rises 5px and falls, infinite loop
this.tweens.add({
    targets: drop, y: y - 5, yoyo: true, duration: 1000,
    repeat: -1, ease: 'Sine.easeInOut'
});

// 3. Pulsing glow ring
const glow = this.add.circle(x, y, 20);
glow.setStrokeStyle(2, 0xffff00, 0.5);  // Yellow ring
this.tweens.add({
    targets: glow, scale: 1.5, alpha: 0, duration: 1000, repeat: -1
});
drop.glowEffect = glow;

// 4. Auto-destroy after 30 seconds
this.time.delayedCall(30000, () => {
    if(drop.active) {
        if(drop.glowEffect) drop.glowEffect.destroy();
        drop.destroy();
    }
});
```

### 15. Death Corpse

When a StickFigure dies, a static "corpse" graphic is drawn at the death location showing splayed limbs.

**Implementation** (`StickFigure.die`, ~L417–456):

```typescript
// 1. Clear all live graphics and destroy weapon/name
this.graphics.clear();
this.reloadBar.clear();
this.weaponContainer.destroy();
this.nameText.destroy();
this.destroy();  // Destroy physics sprite

// 2. Draw corpse: gray splayed limbs + head circle
const deadGfx = scene.add.graphics();
deadGfx.lineStyle(3, 0x444444, 1);  // Gray

// 4 limb lines radiating from center at angles relative to rotation
// Angles: rot±0.5 and rot±2.5 radians, length 20px each
deadGfx.moveTo(x, y);
deadGfx.lineTo(x + Math.cos(rot + 0.5) * 20, y + Math.sin(rot + 0.5) * 20);
// ... (4 limbs total)

// Head circle at rot direction, 25px forward, radius 10
deadGfx.fillCircle(x + Math.cos(rot) * 25, y + Math.sin(rot) * 25, 10);

// 3. Fade out after 5 second delay, over 2 seconds
scene.tweens.add({
    targets: deadGfx, alpha: 0, duration: 2000, delay: 5000,
    onComplete: () => deadGfx.destroy()
});
```

### 16. Damage Flash (StickFigure)

When a StickFigure takes damage, its graphics briefly flash transparent.

**Implementation** (`StickFigure.takeDamage`, ~L393–410):

```typescript
this.scene.tweens.addCounter({
    from: 255, to: 0, duration: 100,
    onUpdate: (tween) => {
        const val = Math.floor(tween.getValue());
        this.graphics.alpha = val / 255;  // Fades to 0 in 100ms
    },
    onComplete: () => {
        this.graphics.alpha = 1;  // Restore full opacity
    }
});
```

This creates a brief 100ms blink effect. Note: the alpha goes from 1→0→1 (full opacity → transparent → back) due to the tween counting 255→0 and then restoring alpha to 1 in `onComplete`.

### 17. Blocked Barrel Spark

When a gun fires but the barrel position is inside a wall, a yellow spark appears instead of a bullet.

**Implementation** (`fireBullet`, ~L569–571):

```typescript
const spark = this.add.circle(startPos.x, startPos.y, 3, 0xffff00);
this.tweens.add({
    targets: spark, alpha: 0, scale: 2, duration: 100,
    onComplete: () => spark.destroy()
});
```

The spark is a yellow circle (radius 3) that grows to 2× scale while fading over 100ms.

### 18. Camera Shake (on hit dealt)

When the player hits an enemy, the camera shakes briefly.

**Implementation** (`showHitMarker`, ~L846):

```typescript
this.cameras.main.shake(50, 0.001);  // 50ms, very subtle
```

### 19. Debug Overlay

A small debug text display appears in the top-left at (10, 150).

**Implementation** (`update`, ~L205–212):

```typescript
this.debugText.setText([
    `FPS: ${Math.round(1000/delta)}`,
    `Update: ${(end - start).toFixed(2)}ms`,
    `AI: ${(aiEnd - aiStart).toFixed(2)}ms`,
    `E: ${this.enemies.countActive()} | B: ${this.bullets.countActive() + this.enemyBullets.countActive()}`
]);
```

Properties: `fontFamily: 'monospace'`, `fontSize: '10px'`, `color: '#00ff00'`, `backgroundColor: '#00000088'`. Uses `setScrollFactor(0)` (fixed to screen) at depth 9999.

---

## Error Handling

### Missing Graphics Reference

**Trigger**: `this.graphics` or `this.tracerGraphics` is null/destroyed
**Detection**: Null check at start of draw functions
**Response**: Functions return early without drawing
**Example**: `if (!this.tracerGraphics) return;` in `updateTracers()`

### Destroyed Entity Effects

**Trigger**: Entity destroyed while tween is active
**Detection**: `!unit.active` check in tween `onUpdate`/`onComplete` callbacks
**Response**: Tween is stopped early (`tween.stop()`) or callback skips work
**Example**: Reload tween checks `if (!unit.active) { tween.stop(); return; }` (~L365–367)

### Inactive Weapon Container

**Trigger**: `weaponContainer` destroyed during animation
**Detection**: `this.weaponContainer.active` check
**Response**: Skip update; in `onComplete`, guard with `this.weaponContainer && this.weaponContainer.active`

---

## Implementation Notes

### TypeScript (Client — Phaser 3)

- **No object pooling**: All effects (particles, text, indicators) are created with `scene.add.*` and destroyed via `onComplete` callbacks. This is acceptable for the prototype's scale (~5 enemies) but would not scale to 8-player multiplayer.
- **Graphics per entity**: Each `StickFigure` owns its own `Phaser.GameObjects.Graphics` instance. These are cleared and redrawn every frame in `draw()`.
- **Depth layering**: Effects use explicit depth values:
  - 5: Weapon drops
  - 999: Tracer graphics
  - 1000: Hit markers, damage numbers
  - 1001: Directional indicators
  - 1999: Minimap static layer
  - 2000: Minimap dynamic layer
  - 9999: Debug text overlay
- **World space vs screen space**: Tracers, blood particles, melee arcs, and hit indicators are in world space (scroll with camera). Minimap and debug text use `setScrollFactor(0)` to stay fixed on screen.
- **Tween cleanup**: All ad-hoc effects destroy themselves in their tween `onComplete` callback. No manual cleanup system exists.

---

## Test Scenarios

### TS-RENDER-001: Minimap Draws Player Dot

**Category**: Visual
**Priority**: Medium

**Preconditions:**
- Scene created, player alive

**Expected Output:**
- Green dot (0x00ff00, radius 4) at minimap position corresponding to player world position
- Position = (20 + player.x * 0.075, 20 + player.y * 0.075)

---

### TS-RENDER-002: Minimap Radar Range Filters Enemies

**Category**: Visual
**Priority**: Medium

**Preconditions:**
- Player alive, enemies at various distances

**Expected Output:**
- Enemies within 600px shown as red dots (radius 3)
- Enemies beyond 600px not shown
- Green ring at radius 600 × 0.075 = 45px around player dot

---

### TS-RENDER-003: Tracer Creates on Hit and Fades

**Category**: Unit
**Priority**: Low

**Preconditions:**
- Player hits enemy

**Input:**
- `showHitMarker(enemy, false)` called

**Expected Output:**
- Tracer added to `activeTracers` with alpha=1, color=0xffffff
- Alpha decreases by `delta/150` per frame
- Removed from array when alpha <= 0

---

### TS-RENDER-004: Hit Marker Kill vs Hit Distinction

**Category**: Unit
**Priority**: Medium

**Preconditions:**
- Reticle exists at known position

**Input:**
- `showHitMarker(target, true)` for kill
- `showHitMarker(target, false)` for hit

**Expected Output:**
- Kill: tint 0xff0000, scale 2.0
- Hit: tint 0xffffff, scale 1.2

---

### TS-RENDER-005: Blood Particles on Player Damage

**Category**: Visual
**Priority**: Medium

**Preconditions:**
- Player alive, takes damage from known source position

**Expected Output:**
- 5 circle particles spawned at player position
- Each particle: radius 2–5, color 0xcc0000
- Velocity directed away from damage source
- Fade and scale to 0 over 500ms

---

### TS-RENDER-006: Damage Numbers Float and Fade

**Category**: Visual
**Priority**: Medium

**Preconditions:**
- Enemy takes damage

**Expected Output:**
- Text showing damage amount at (enemy.x, enemy.y - 30)
- Rises to y - 80 (50px upward)
- Fades to alpha 0 over 800ms
- Kill: 24px, red; Non-kill: 16px, white

---

### TS-RENDER-007: Muzzle Flash Appears on Ranged Fire

**Category**: Visual
**Priority**: Low

**Preconditions:**
- Ranged weapon fired

**Expected Output:**
- Yellow-white circle (0xffffaa, radius 8) at barrel position
- Fades and shrinks over 40ms
- Shotgun has scale 1.5

---

### TS-RENDER-008: Death Corpse Persists Then Fades

**Category**: Visual
**Priority**: Low

**Preconditions:**
- StickFigure dies

**Expected Output:**
- Gray splayed-limb graphic drawn at death position
- Visible for 5000ms
- Fades to alpha 0 over next 2000ms
- Destroyed after fade completes

---

### TS-RENDER-009: Health Regen Particles During Regeneration

**Category**: Visual
**Priority**: Low

**Preconditions:**
- Player health < 100, more than 3000ms since last damage

**Expected Output:**
- ~15% chance per frame: green circle (0x00ff00, radius 2) spawns near player
- Floats upward 20px over 600ms
- Fades to alpha 0

---

### TS-RENDER-010: Camera Flash on Damage Received

**Category**: Visual
**Priority**: Medium

**Preconditions:**
- Player takes damage

**Expected Output:**
- `cameras.main.flash(100, 128, 0, 0)` called — red flash for 100ms

---

### TS-RENDER-011: Melee Slash Arc Renders and Fades

**Category**: Visual
**Priority**: Low

**Preconditions:**
- Melee attack performed

**Expected Output:**
- White arc (2px, 0xffffff, alpha 0.8) at attacker position
- Arc from `rotation - 0.7` to `rotation + 0.7` radians at weapon range radius
- Fades to alpha 0 over 200ms

---

### TS-RENDER-012: Weapon Drop Bobs and Glows

**Category**: Visual
**Priority**: Low

**Preconditions:**
- Enemy killed, weapon drop spawned

**Expected Output:**
- Drop sprite bobs 5px vertically, 1s period, infinite loop
- Yellow ring (0xffff00, radius 20) pulses: scales to 1.5, fades to 0, repeats
- Drop auto-destroys after 30 seconds

---

## Changelog

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-02-15 | Initial specification |
