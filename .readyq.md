# Task: Weapon Balance Research & Validation

**ID**: 0726703fa9234d0dbcea12d708ca61d6
**Created**: 2025-12-09T05:26:01.985269+00:00
**Updated**: 2025-12-09T05:26:16.235070+00:00
**Blocks**: 82ded3287fb44d44a78732b9feaac0e9
**Blocked By**: 

## Status

- [x] Open
- [ ] In Progress
- [ ] Blocked
- [ ] Done

## Description

<description>
## Story 3.0: Weapon Balance Research & Validation

As a developer,
I want to validate weapon balance across all 5 weapons before implementation,
So that combat feels fair and each weapon has a distinct role.

**Acceptance Criteria:**

**Given** the GDD weapon specifications and Epic 3 story definitions
**When** I analyze weapon stats (damage, fire rate, range, reload time)
**Then** I create a weapon balance spreadsheet with:
- DPS calculations for each weapon
- Time-to-Kill (TTK) at various ranges
- Effective range analysis
- Risk/reward trade-off matrix

**And** validate that:
- Melee weapons have highest DPS but require close range (high risk/reward)
- Ranged weapons have damage falloff with distance
- No weapon is strictly superior to others (each has tactical niche)
- Weapon stats from GDD align with Epic 3 story acceptance criteria

**And** document any recommended stat adjustments before implementation

**Prerequisites:** Epic 2 complete

**Technical Notes:**
- Review GDD weapon stats vs Epic 3.2 (Bat/Katana) and 3.3 (Uzi/AK47/Shotgun)
- Create balance spreadsheet: damage, fire rate, magazine size, reload time, range
- Calculate DPS = damage × fire rate
- Calculate TTK = 100 HP / DPS (accounting for reload time)
- Validate melee risk/reward (high DPS but need to close distance)
- Ensure no dominant strategy (rock-paper-scissors balance)

**Estimated Effort:** 2-4 hours research and validation
</description>

---

# Task: Story 3.1: Implement Weapon Pickup System

**ID**: 82ded3287fb44d44a78732b9feaac0e9
**Created**: 2025-12-09T05:26:16.235070+00:00
**Updated**: 2025-12-09T05:26:29.699075+00:00
**Blocks**: 5582c4097a004900a0ba87de14719f6a
**Blocked By**: 0726703fa9234d0dbcea12d708ca61d6

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to pick up weapons from map spawns,
So that I can gain tactical advantage.

**Acceptance Criteria:**

**Given** a weapon (Uzi) spawned at position {x: 500, y: 600}
**When** I move within 32 pixels of the weapon
**Then** "Press E to pick up Uzi" prompt appears on screen

**And** when I press E key, I send `player:pickup` message to server
**And** server validates I am in range and weapon exists
**And** server removes weapon from map, adds to my inventory, broadcasts `weapon:pickedup`
**And** weapon sprite disappears for all players
**And** my current weapon is replaced (dropped at my location if not default pistol)

**And** weapon respawns at the same location after 30 seconds
**And** weapon spawn notification: subtle glow effect on map and minimap

**Quality Requirements:**
- Integration tests for pickup range detection and visual prompt rendering
- Browser acceptance tests for E-prompt visibility and weapon sprite removal
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.0 (weapon balance research)

**Technical Notes:**
- Weapon spawn data: {id, type, x, y, respawnTime}
- Server tracks weapon state: {available: true/false, nextRespawn: timestamp}
- Pickup range: 32 pixels (circular collision check)
- Weapon switch instant (no animation delay for MVP)
- Dropped weapons disappear after 10 seconds (prevent clutter)
- Each map has 3-5 fixed weapon spawn points defined in map config
</description>

---

# Task: Story 3.2: Implement Melee Weapons (Bat and Katana)

**ID**: 5582c4097a004900a0ba87de14719f6a
**Created**: 2025-12-09T05:26:29.699075+00:00
**Updated**: 2025-12-09T05:26:45.917853+00:00
**Blocks**: b3c92824f9524fa580c1cda1328e3674
**Blocked By**: 82ded3287fb44d44a78732b9feaac0e9

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to use melee weapons for high-risk, high-reward close combat,
So that I can dominate at short range.

**Acceptance Criteria:**

**Given** I have a Bat equipped
**When** I click to attack
**Then** my stick figure swings the bat in a 90-degree arc in the aim direction

**And** any enemy within melee range (64 pixels) and within the swing arc takes 25 damage
**And** bat attacks at 0.5 second intervals (fast)
**And** hit enemies are knocked back slightly (40 pixels in hit direction)
**And** melee hit plays satisfying "thwack" sound with screen shake

**And** given I have a Katana equipped
**When** I click to attack
**Then** the katana slashes with 45 damage, 0.8 second cooldown, 80 pixel range

**And** katana has longer reach than bat but slower attack speed
**And** both weapons have no ammo (infinite uses)
**And** melee attacks require precise timing and positioning

**Quality Requirements:**
- Integration tests for arc-based hit detection (cone collision)
- Browser acceptance tests for melee swing visualization and knockback
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.1

**Technical Notes:**
- Bat stats: {damage: 25, cooldown: 0.5s, range: 64px, arc: 90°}
- Katana stats: {damage: 45, cooldown: 0.8s, range: 80px, arc: 90°}
- Server hit detection: check enemies in cone-shaped area from player
- Knockback velocity: 200 px/s for 0.2 seconds
- Animation: 4-frame swing (0.2s duration)
- Melee priority: if multiple enemies in range, hit all (AoE)
- Balance: melee is high-risk (need to close distance) but high DPS
</description>

---

# Task: Story 3.3: Implement Ranged Weapons (Uzi, AK47, Shotgun)

**ID**: b3c92824f9524fa580c1cda1328e3674
**Created**: 2025-12-09T05:26:45.917853+00:00
**Updated**: 2025-12-09T05:26:57.560223+00:00
**Blocks**: bf3afdf7392741b2afcc0928c8b0af4a
**Blocked By**: 5582c4097a004900a0ba87de14719f6a

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to use ranged weapons with distinct characteristics,
So that I can choose weapons matching my playstyle.

**Acceptance Criteria:**

**Given** I have an Uzi equipped
**When** I hold down mouse button
**Then** the Uzi fires in full-auto at 10 rounds/second

**And** each bullet does 8 damage with medium range (600px max)
**And** Uzi has 30-round magazine, 1.5 second reload
**And** recoil climbs upward (aim angle increases by 2° per shot, recovers over 0.5s)
**And** bullet spread increases while moving (±5° spread)

**And** given I have an AK47 equipped
**When** I click to fire
**Then** the AK47 fires semi-auto at 6 rounds/second (hold for continuous fire)

**And** each bullet does 20 damage with long range (800px max)
**And** AK47 has 30-round magazine, 2.0 second reload
**And** balanced recoil (horizontal + vertical, ±3° pattern)
**And** accurate while stationary, spread while moving

**And** given I have a Shotgun equipped
**When** I click to fire
**Then** the shotgun fires 8 pellets in spread pattern

**And** each pellet does 7.5 damage (60 total if all hit) with short range (300px max)
**And** pellet spread: 15° cone from aim angle
**And** devastating at close range (all pellets hit), weak at distance (spread too wide)
**And** slow fire rate: 1 shot per second, 6-round magazine, 2.5 second reload

**Quality Requirements:**
- Integration tests for recoil patterns and bullet spread mechanics
- Browser acceptance tests for full-auto fire rate and visual feedback
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.2

**Technical Notes:**
- Uzi: {damage: 8, fireRate: 10/s, mag: 30, reload: 1.5s, range: 600px}
- AK47: {damage: 20, fireRate: 6/s, mag: 30, reload: 2.0s, range: 800px}
- Shotgun: {damage: 60 total (8 pellets × 7.5), fireRate: 1/s, mag: 6, reload: 2.5s, range: 300px}
- Shotgun pellet spread: each pellet angle offset by random ±7.5° from aim
- Recoil patterns stored as {x, y} offset arrays per weapon
- Bullet drop-off: damage decreases linearly after 50% of max range
- Server validates fire rate (prevent macros/exploits)
</description>

---

# Task: Story 3.4: Implement Manual Reload Mechanic

**ID**: bf3afdf7392741b2afcc0928c8b0af4a
**Created**: 2025-12-09T05:26:57.560223+00:00
**Updated**: 2025-12-09T05:27:08.235821+00:00
**Blocks**: 748ca953182343dd80a0f3b414271101
**Blocked By**: b3c92824f9524fa580c1cda1328e3674

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to manually reload my weapon,
So that I can choose optimal timing for vulnerability.

**Acceptance Criteria:**

**Given** my AK47 has 5 rounds remaining
**When** I press R key
**Then** reload animation starts (2.0 seconds for AK47)

**And** during reload, I cannot shoot (clicking does nothing)
**And** reload progress bar appears on HUD (fills over 2 seconds)
**And** reload can be canceled by switching weapons (lose progress)
**And** after reload completes, magazine refills to 30 rounds

**And** if I attempt to shoot with empty magazine, auto-reload starts
**And** empty magazine indicator: "RELOAD!" flashes on screen in red
**And** reload sound effect plays (unique per weapon)

**And** I can move, sprint, and dodge while reloading (not stunned)

**Quality Requirements:**
- Integration tests for reload cancellation and auto-reload trigger
- Browser acceptance tests for reload progress UI visibility and timing
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.3

**Technical Notes:**
- Reload time per weapon: Uzi (1.5s), AK47 (2.0s), Shotgun (2.5s)
- Server tracks reload state: {isReloading: bool, reloadStartTime: timestamp}
- Reload progress: (now - reloadStartTime) / reloadDuration
- Cancel reload: switch weapon or pickup new weapon
- Auto-reload trigger: attempt to shoot with ammo === 0
- Animation: character lowers weapon, reload gesture, raises weapon
- UI: circular reload indicator around crosshair
</description>

---

# Task: Story 3.5: Implement Sprint Mechanic

**ID**: 748ca953182343dd80a0f3b414271101
**Created**: 2025-12-09T05:27:08.235821+00:00
**Updated**: 2025-12-09T05:27:21.674369+00:00
**Blocks**: f48fe88ced7f4208b3e8f810895c9531
**Blocked By**: bf3afdf7392741b2afcc0928c8b0af4a

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to sprint for faster movement,
So that I can reposition quickly or retreat from danger.

**Acceptance Criteria:**

**Given** I am moving with WASD keys
**When** I hold Shift key
**Then** my movement speed increases from 200 px/s to 300 px/s (1.5× multiplier)

**And** sprint has no stamina limit (can sprint indefinitely)
**And** sprinting applies accuracy penalty (bullet spread increases by 50%)
**And** sprinting makes louder footstep sounds (audio cue for enemies)
**And** visual indicator: subtle motion blur or speed lines

**And** sprinting does not prevent shooting, reloading, or aiming
**And** releasing Shift returns to normal movement speed instantly

**Quality Requirements:**
- Integration tests for sprint accuracy penalty mechanics
- Browser acceptance tests for speed visual indicator and movement feel
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.4

**Technical Notes:**
- Sprint speed: 300 px/s (vs normal 200 px/s)
- Accuracy penalty: multiply bullet spread by 1.5 when isSprinting === true
- Server validates sprint input (cannot sprint + move slower, prevents speed hacks)
- Footstep volume: +30% louder while sprinting
- Visual effect: camera FOV increases slightly (zoom out effect)
- No stamina system for MVP (infinite sprint, simple mechanic)
</description>

---

# Task: Story 3.6: Implement Dodge Roll with Invincibility Frames

**ID**: f48fe88ced7f4208b3e8f810895c9531
**Created**: 2025-12-09T05:27:21.674369+00:00
**Updated**: 2025-12-09T05:27:38.565701+00:00
**Blocks**: 520728e6e1ad400b8bd51b1fbd787500
**Blocked By**: 748ca953182343dd80a0f3b414271101

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want to dodge roll to evade attacks,
So that I can outplay opponents with skillful timing.

**Acceptance Criteria:**

**Given** I am in combat
**When** I press Space bar
**Then** my stick figure performs a roll in the current movement direction (or forward if stationary)

**And** roll duration: 0.4 seconds, covers 100 pixels
**And** during first 0.2 seconds: invincibility frames (cannot take damage)
**And** during last 0.2 seconds: vulnerable to damage
**And** dodge cooldown: 3 seconds (cannot roll again for 3s)

**And** visual indicator: character sprite rolls with transparency effect during i-frames
**And** cooldown UI: circular timer shows when dodge is available again
**And** dodge sound effect: quick "whoosh"

**And** cannot shoot, reload, or switch weapons during roll
**And** roll direction: based on WASD keys pressed (or aim direction if no keys pressed)

**Quality Requirements:**
- Integration tests for i-frame invincibility timing and cooldown enforcement
- Browser acceptance tests for dodge visual feedback and input restriction
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.5

**Technical Notes:**
- Roll stats: {duration: 0.4s, distance: 100px, iframes: 0.2s, cooldown: 3s}
- Server tracks roll state: {isRolling: bool, rollStartTime, lastRollTime}
- Invincibility check: if (isRolling && now - rollStartTime < 200) { return; }
- Roll velocity: 250 px/s for 0.4 seconds
- Animation: 6-frame roll animation, sprite rotates 360°
- Cooldown enforcement: client shows UI, server validates (prevent spam)
- Roll cancels: stopped if hitting wall/obstacle
</description>

---

# Task: Story 3.7A: Character & Weapon Sprites

**ID**: 520728e6e1ad400b8bd51b1fbd787500
**Created**: 2025-12-09T05:27:38.565701+00:00
**Updated**: 2025-12-09T05:27:52.746670+00:00
**Blocks**: 09f1d0cbeffa4a36b91487c79b57a3e3
**Blocked By**: f48fe88ced7f4208b3e8f810895c9531

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want visually distinct characters and weapons,
So that the game looks presentable and weapons are easily identifiable.

**Acceptance Criteria:**

**Given** I am playing the game after completing weapon mechanics
**When** I look at my character and weapons
**Then** I see proper stick figure sprites (not primitive shapes)

**And** stick figure character has:
- Simple but clean 16×32 pixel sprite (head, body, limbs clearly visible)
- 4-frame walk animation (8-12 FPS, cycles smoothly)
- Distinct idle pose vs moving pose
- Color customization working (black default, other colors unlocked)

**And** all 5 weapons have unique sprites:
- Pistol: small handgun shape, 8×8 pixels, silver/gray
- Bat: wooden bat, 16×4 pixels, brown
- Katana: sleek blade, 20×4 pixels, silver with black handle
- Uzi: compact SMG shape, 12×8 pixels, black/gray
- AK47: rifle shape, 20×8 pixels, wood/metal colors
- Shotgun: pump-action shape, 18×8 pixels, dark gray/brown

**And** weapons rotate correctly with aim angle (anchor point at handle)
**And** weapons visible when held by other players (rendered at player position + aim angle)

**Quality Requirements:**
- Browser acceptance tests for sprite rendering and weapon visibility
- All assets optimized: PNG with compression, <500KB total for all sprites
- Tests updated: mock new sprite paths, verify rendering methods called
- >90% coverage on all metrics (statements, branches, functions, lines)

**Prerequisites:** Story 3.6

**Technical Notes:**
- Use free assets from Kenney.nl (Micro Roguelike, Top-Down Shooter packs)
- Or create simple pixel art (16×16 or smaller, 1 day scope)
- Client assets: public/assets/sprites/character.png, weapons/*.png
- Phaser sprite loading: this.load.spritesheet with frameWidth/frameHeight
- Animation config: this.anims.create with generateFrameNumbers
- Weapon rendering: this.add.sprite(x, y, weapon_type).setRotation(aimAngle)
- Sprites must be readable at 1920×1080 resolution
</description>

---

# Task: Story 3.7B: Health Bars & Hit Effects

**ID**: 09f1d0cbeffa4a36b91487c79b57a3e3
**Created**: 2025-12-09T05:27:52.746670+00:00
**Updated**: 2025-12-09T05:27:52.746670+00:00
**Blocks**: 
**Blocked By**: 520728e6e1ad400b8bd51b1fbd787500

## Status

- [ ] Open
- [ ] In Progress
- [x] Blocked
- [ ] Done

## Description

<description>
As a player,
I want clear visual feedback during combat,
So that I can track health and understand hit registration.

**Acceptance Criteria:**

**Given** I am in combat with other players
**When** damage is dealt or health changes
**Then** I see clear visual feedback

**And** health bar UI visible above each player:
- Green bar (health), gray background, 32×4 pixels
- Updates in real-time as health changes
- Positioned 8 pixels above player head
- Scales proportionally from 0-100 HP

**And** basic hit effects (minimal, not full particle systems):
- Bullet impact: small yellow flash sprite (4×4 pixels, fades in 0.1s)
- Melee hit: white impact lines (simple graphic, not particles)
- Muzzle flash: small orange/yellow flash at gun barrel (fades in 0.1s)

**And** all effects are performant (60 FPS maintained with 8 players fighting)

**Quality Requirements:**
- Browser acceptance tests for health bar visibility and hit effect rendering
- Performance testing: verify 60 FPS with all effects active
- >90% coverage on all metrics (statements, branches, functions, lines)
- Zero TypeScript errors, zero ESLint warnings

**Prerequisites:** Story 3.7A

**Technical Notes:**
- Health bar: Phaser Graphics object, rectangle drawn above player each frame
- Hit effects: Simple sprites with tween alpha fade
- this.add.sprite(x, y, impact_flash).setAlpha(1).tween({alpha: 0, duration: 100, onComplete: destroy})
- All assets optimized: PNG with compression
- Effects pooled/reused (not created/destroyed per hit for performance)
- NO particle systems (deferred to Epic 9 Story 9.1)
- NO advanced animations or camera effects (deferred to Epic 9)
- Focus: basic polish that makes game shareable
</description>
