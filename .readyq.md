# Task: BUG: Health regeneration not working as designed

**ID**: 4bcdb803667140a2913ae14614c1edbe
**Created**: 2025-12-08T07:32:14.117286+00:00
**Updated**: 2025-12-08T07:32:14.117286+00:00
**Blocks**: 
**Blocked By**: 

## Status

- [x] Open
- [ ] In Progress
- [ ] Blocked
- [ ] Done

## Description

<description>
## Bug Report

**Expected Behavior (from GDD and Epic docs):**
- Health regenerates after 5 seconds of no damage at 10 HP/second
- Regeneration continues until health reaches 100 HP
- Taking damage interrupts regeneration and resets the 5-second timer
- Visual feedback: health bar pulses/glows during regeneration

**Actual Behavior:**
Health regeneration is not working as planned (needs investigation to determine exact issue)

## Acceptance Criteria

**Given** a player has taken damage and has less than 100 HP
**When** 5 seconds pass without taking additional damage
**Then** health should begin regenerating at 10 HP/second

**And** regeneration should stop immediately when damage is taken
**And** regeneration should stop when health reaches 100 HP
**And** visual feedback should indicate regeneration is active

## Technical References
- Story 2.7.1: Server-Side Health Regeneration (34e9472c) - marked done
- Story 2.7.2: Client-Side Regeneration Feedback (e855028f) - marked done
- GDD: "Health regeneration - After delay (encourages tactical disengagement)"
- GDD: "Health: Regenerates after damage delay (5 seconds)"

## Investigation Needed
1. Verify server is correctly tracking lastDamageTime
2. Verify regeneration rate is 10 HP/second (not 5 HP/second as some code shows)
3. Verify isRegenerating flag is being broadcast correctly
4. Verify client is receiving and displaying regeneration state

## Priority
High - Core combat mechanic affecting gameplay balance
</description>

---

# Task: BUG: Player characters duplicated when starting new match after first match ends

**ID**: d789671295f54687835999b63c65fd70
**Created**: 2025-12-08T07:32:15.632837+00:00
**Updated**: 2025-12-08T07:32:15.632837+00:00
**Blocks**: 
**Blocked By**: 

## Status

- [x] Open
- [ ] In Progress
- [ ] Blocked
- [ ] Done

## Description

<description>
## Bug Report

**Expected Behavior:**
- When a match ends and a new match starts, only the current players should be rendered
- Previous match state should be fully cleaned up
- Each player should have exactly one character sprite

**Actual Behavior:**
After the first match ends and a new match starts, player characters are duplicated on screen.

## Reproduction Steps
1. Start a match with 2+ players
2. Play until match ends (kill target or time limit)
3. Start a new match
4. Observe: player characters appear duplicated

## Acceptance Criteria

**Given** a match has ended
**When** a new match starts
**Then** only the current match players should be rendered (no duplicates)

**And** all previous match sprites/entities should be destroyed
**And** player state should be fully reset
**And** no visual artifacts from previous match should remain

## Technical Investigation Needed
1. Check if GameScene.destroy() properly cleans up all player sprites
2. Check if PlayerManager.clear() is called between matches
3. Check if room:joined handler creates new sprites without destroying old ones
4. Check if match:ended â†’ match:start transition cleans up state properly

## Root Cause Hypothesis
- Player sprites from previous match not being destroyed
- Or: room:joined event adding players without clearing existing player list
- Or: GameScene not properly resetting between matches

## Priority
High - Game-breaking visual bug affecting core gameplay loop
</description>
